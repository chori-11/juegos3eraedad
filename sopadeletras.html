<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sopa de Letras - Palabras Cruzadas</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #fff8e1; /* Un crema suave, cálido */
      margin: 0;
      padding: 10px;
      user-select: none;
    }

    h1 { color: #5d4037; margin: 10px 0; font-size: 1.8rem; text-align: center; }
    
    .status-bar {
      margin-bottom: 15px;
      font-size: 1.1rem;
      color: #795548;
      font-weight: bold;
      text-align: center;
    }

    /* Contenedor del juego: Tablero + Lista */
    .game-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      max-width: 800px;
      width: 100%;
    }

    /* El Tablero */
    #grid-container {
      display: grid;
      background: #8d6e63;
      padding: 5px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      /* El grid-template se define en JS */
    }

    .cell {
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.3rem; /* Letra grande */
      font-weight: bold;
      cursor: pointer;
      color: #333;
      border: 1px solid #d7ccc8;
      width: 40px; 
      height: 40px;
      transition: background 0.2s;
    }

    /* Estados de la celda */
    .cell:hover { background-color: #fff9c4; } /* Amarillo suave al pasar mouse */
    
    .cell.selected-first {
      background-color: #ffeb3b !important; /* Selección inicial */
      color: #000;
      border: 2px solid #fbc02d;
    }

    .cell.found {
      background-color: #a5d6a7 !important; /* Verde éxito */
      color: #1b5e20;
    }

    /* La Lista de Palabras */
    #word-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 150px;
    }
    
    .word-item {
      font-size: 1.2rem;
      color: #5d4037;
      padding: 5px 10px;
      background: white;
      border-radius: 4px;
      border: 1px solid #d7ccc8;
    }
    
    .word-item.done {
      text-decoration: line-through;
      color: #9e9e9e;
      background: #f5f5f5;
    }

    /* Controles */
    .controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .btn-new { background-color: #fb8c00; }
    
    #message {
      margin-top: 15px;
      font-size: 1.5rem;
      color: #2e7d32;
      font-weight: bold;
      min-height: 40px;
      text-align: center;
    }

  </style>
</head>
<body>

  <h1>Sopa de Letras</h1>
  <div class="status-bar">Categoría: <span id="category-name">Cargando...</span></div>

  <div class="game-container">
    <div id="grid-container"></div>
    <div id="word-list"></div>
  </div>

  <div id="message"></div>

  <div class="controls">
    <button class="btn btn-new" onclick="newGame()">Nueva Partida</button>
  </div>
  
  <p style="text-align:center; color:#666; font-size:0.9rem; max-width:500px; margin-top:20px;">
    <strong>Cómo jugar:</strong> Haz clic en la primera letra de la palabra y luego clic en la última letra. Las palabras pueden estar en horizontal o vertical.
  </p>

<script>
  /* CONFIGURACIÓN */
  const GRID_SIZE = 10; // Tablero de 10x10 (grande pero no abrumador)
  
  // Banco de palabras categorizado
  const CATEGORIES = {
    "ANIMALES": ["GATO", "PERRO", "LEON", "TIGRE", "PATO", "VACA"],
    "COLORES":  ["ROJO", "AZUL", "VERDE", "GRIS", "ROSA", "NEGRO"],
    "CASA":     ["MESA", "SILLA", "CAMA", "SOFA", "BAÑO", "LUZ"],
    "COMIDA":   ["PAN", "SOPA", "ARROZ", "AGUA", "FRUTA", "SAL"],
    "ROPA":     ["CAMISA", "PANTALON", "GORRO", "MEDIA", "SACO"]
  };

  let grid = []; // Matriz lógica
  let placedWords = []; // Palabras colocadas con sus coordenadas
  let firstSelection = null; // Coordenada del primer clic {r, c}
  let wordsFound = 0;
  let currentWordList = [];

  window.onload = newGame;

  function newGame() {
    // 1. Elegir categoría al azar
    const catKeys = Object.keys(CATEGORIES);
    const randomCat = catKeys[Math.floor(Math.random() * catKeys.length)];
    currentWordList = [...CATEGORIES[randomCat]]; // Copia para no mutar original

    document.getElementById('category-name').textContent = randomCat;
    document.getElementById('message').textContent = '';
    
    // 2. Inicializar Grid vacío
    grid = Array.from({ length: GRID_SIZE }, () => Array(GRID_SIZE).fill(''));
    placedWords = [];
    wordsFound = 0;
    firstSelection = null;

    // 3. Colocar palabras
    placeWordsInGrid(currentWordList);

    // 4. Rellenar huecos
    fillEmptySpaces();

    // 5. Renderizar
    renderGrid();
    renderWordList();
  }

  function placeWordsInGrid(words) {
    // Intentar colocar cada palabra
    // Para simplificar a personas mayores, priorizamos Horizontal y Vertical.
    // Diagonal la evitamos en este nivel "intermedio" para no frustrar.
    const directions = [[0, 1], [1, 0]]; // [row, col] -> Horizontal, Vertical

    for (let word of words) {
      let placed = false;
      let attempts = 0;
      while (!placed && attempts < 100) {
        const dir = directions[Math.floor(Math.random() * directions.length)];
        const row = Math.floor(Math.random() * GRID_SIZE);
        const col = Math.floor(Math.random() * GRID_SIZE);

        if (canPlace(word, row, col, dir)) {
          doPlace(word, row, col, dir);
          placed = true;
        }
        attempts++;
      }
    }
  }

  function canPlace(word, row, col, [dr, dc]) {
    // Verificar límites
    if (row + dr * (word.length - 1) >= GRID_SIZE) return false;
    if (col + dc * (word.length - 1) >= GRID_SIZE) return false;

    // Verificar colisiones
    for (let i = 0; i < word.length; i++) {
      const charAtGrid = grid[row + dr * i][col + dc * i];
      // Si la casilla no está vacía Y no es la misma letra, no se puede
      if (charAtGrid !== '' && charAtGrid !== word[i]) return false;
    }
    return true;
  }

  function doPlace(word, row, col, [dr, dc]) {
    for (let i = 0; i < word.length; i++) {
      grid[row + dr * i][col + dc * i] = word[i];
    }
    // Guardar metadata para validar después
    placedWords.push({
      word: word,
      start: { r: row, c: col },
      end: { r: row + dr * (word.length - 1), c: col + dc * (word.length - 1) },
      found: false
    });
  }

  function fillEmptySpaces() {
    const letters = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";
    for (let r = 0; r < GRID_SIZE; r++) {
      for (let c = 0; c < GRID_SIZE; c++) {
        if (grid[r][c] === '') {
          grid[r][c] = letters[Math.floor(Math.random() * letters.length)];
        }
      }
    }
  }

  /* RENDERIZADO */
  function renderGrid() {
    const container = document.getElementById('grid-container');
    container.innerHTML = '';
    container.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;

    for (let r = 0; r < GRID_SIZE; r++) {
      for (let c = 0; c < GRID_SIZE; c++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.textContent = grid[r][c];
        cell.dataset.r = r;
        cell.dataset.c = c;
        cell.onclick = () => handleCellClick(r, c, cell);
        cell.id = `cell-${r}-${c}`;
        container.appendChild(cell);
      }
    }
  }

  function renderWordList() {
    const listDiv = document.getElementById('word-list');
    listDiv.innerHTML = '';
    placedWords.forEach((pw, idx) => {
      const item = document.createElement('div');
      item.classList.add('word-item');
      item.textContent = pw.word;
      item.id = `word-${pw.word}`;
      if (pw.found) item.classList.add('done');
      listDiv.appendChild(item);
    });
  }

  /* LÓGICA DEL JUEGO */
  function handleCellClick(r, c, cellEl) {
    // Si la palabra ya es parte de una encontrada, ignorar (o permitir cruces, pero simplifiquemos)
    // Permitimos clic si no está marcada como "encontrada" visualmente, aunque a veces se cruzan.
    
    if (!firstSelection) {
      // PRIMER CLIC
      firstSelection = { r, c };
      cellEl.classList.add('selected-first');
    } else {
      // SEGUNDO CLIC
      const start = firstSelection;
      const end = { r, c };
      
      // Limpiar selección visual del primero
      const firstEl = document.getElementById(`cell-${start.r}-${start.c}`);
      if(firstEl) firstEl.classList.remove('selected-first');
      firstSelection = null;

      // Validar si forman una palabra
      checkSelection(start, end);
    }
  }

  function checkSelection(start, end) {
    // Buscar si alguna palabra coincide con estas coordenadas (sin importar orden inicio-fin)
    const match = placedWords.find(pw => {
      if (pw.found) return false;
      
      // Verificar normal
      const normal = (pw.start.r === start.r && pw.start.c === start.c && 
                      pw.end.r === end.r && pw.end.c === end.c);
      // Verificar inverso (si clica el final primero)
      const reverse = (pw.start.r === end.r && pw.start.c === end.c && 
                       pw.end.r === start.r && pw.end.c === start.c);
      return normal || reverse;
    });

    if (match) {
      // ¡Encontrada!
      match.found = true;
      markWordFound(match);
      wordsFound++;
      
      // Actualizar lista
      const listEl = document.getElementById(`word-${match.word}`);
      if(listEl) listEl.classList.add('done');

      // Verificar victoria
      if (wordsFound === placedWords.length) {
        document.getElementById('message').textContent = "¡Felicidades! ¡Completaste la sopa!";
      }
    }
  }

  function markWordFound(pw) {
    // Determinar dirección para pintar
    const dr = Math.sign(pw.end.r - pw.start.r);
    const dc = Math.sign(pw.end.c - pw.start.c);
    const length = Math.max(
      Math.abs(pw.end.r - pw.start.r), 
      Math.abs(pw.end.c - pw.start.c)
    ) + 1;

    for (let i = 0; i < length; i++) {
      const r = pw.start.r + dr * i;
      const c = pw.start.c + dc * i;
      const cell = document.getElementById(`cell-${r}-${c}`);
      if (cell) cell.classList.add('found');
    }
  }

</script>
</body>
</html>